<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BSM322App.HavaDurumuPage"
             Title="Hava Durumu">
    <Grid BackgroundColor="{AppThemeBinding Light=White, Dark=#1a1a1a}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Şehir Ekleme -->
        <StackLayout Grid.Row="0" Orientation="Horizontal" Padding="20,10" Spacing="10">
            <Entry x:Name="CityEntry" Placeholder="Şehir adı (ör: Ankara, Istanbul)" 
                   HorizontalOptions="FillAndExpand"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#3a3a3a}"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            <Button Text="Ekle" BackgroundColor="#FF9800" TextColor="White" 
                    CornerRadius="5" Clicked="OnAddCityClicked"/>
        </StackLayout>

        <!-- Şehir Listesi -->
        <CollectionView Grid.Row="1" x:Name="CitiesCollectionView" ItemsSource="{Binding Cities}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame BackgroundColor="{AppThemeBinding Light=#f8f8f8, Dark=#2a2a2a}" 
                   CornerRadius="10" Margin="15,5" Padding="15">
                        <StackLayout>
                            <!-- Şehir Başlığı ve Sil Butonu -->
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="{Binding Name}" FontAttributes="Bold" FontSize="18" 
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                <Button Grid.Column="1" Text="🗑️" BackgroundColor="Transparent" 
                               TextColor="#F44336" FontSize="20" Clicked="OnDeleteCityClicked"
                               CommandParameter="{Binding}"/>
                            </Grid>
                            <!-- Yükleniyor Göstergesi -->
                            <ActivityIndicator IsVisible="{Binding IsLoading}" IsRunning="{Binding IsLoading}"
                                     Color="#FF9800" VerticalOptions="Center" Margin="0,10"/>
                            <!-- Hava Durumu Bilgileri -->
                            <StackLayout IsVisible="{Binding HasWeatherData}">
                                <!-- MGM Show-2 Format Resmi (Kaydırılabilir) -->
                                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#3a3a3a}" 
                               CornerRadius="8" Padding="5" HasShadow="True" Margin="0,10">
                                    <ScrollView Orientation="Horizontal" 
                                       HorizontalScrollBarVisibility="Never"
                                       VerticalOptions="FillAndExpand">
                                        <Image Source="{Binding MGMImageUrl}" 
                                      HeightRequest="120" 
                                      Aspect="AspectFit"
                                      BackgroundColor="White"
                                      WidthRequest="{Binding MGMImageWidth, FallbackValue=400}"
                                      HorizontalOptions="Start"/>
                                    </ScrollView>
                                </Frame>
                            </StackLayout>
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={x:Reference CitiesCollectionView}, Path=BindingContext.CityTapCommand}" 
                                         CommandParameter="{Binding}"/>
                        </Frame.GestureRecognizers>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>